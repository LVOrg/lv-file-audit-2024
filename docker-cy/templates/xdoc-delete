ARG BASE

FROM ${BASE}
ARG TARGETARCH
ARG OS
COPY ./../docker-cy/check/check_underthesea.py /app/check_underthesea.py
RUN python3 /app/check_underthesea.py
# Cai nay la toan bo moi truong thu vien cua
RUN if [ "$TARGETARCH" = "arm64" ]; then \
    apt update && apt-get upgrade -y &&  apt install build-essential -y ;\
    fi
RUN pip install underthesea
COPY ./../cy_consumers /app/cy_consumers
COPY ./../cy_utils /app/cy_utils
COPY ./../cy_xdoc /app/cy_xdoc
COPY ./../cyx /app/cyx
COPY ./../cy_vn_suggestion /app/cy_vn_suggestion
RUN python3 /app/compact.py /app/cy_vn_suggestion
#COPY ./../resource /app/resource
COPY ./../config.yml /app/config.yml
COPY ./../dataset/easyocr /app/share-storage/dataset/easyocr
COPY ./../cy_controllers /app/cy_controllers
RUN python3 -c 'import cv2'
RUN python3 -m pip install python-memcached==1.59
#memcache-service.lv-cache:11211
#mc = pymemcache.Client(['memcache-service.lv-cache:11211'])
COPY ./../start.sh /app/start.sh
RUN chmod +x /app/start.sh
COPY ./../docker-cy/test /app
COPY ./../gradio_test /web
RUN chmod u+x /app/*.sh
RUN chmod u+x /web/*.sh


WORKDIR /app
#   docker run -p 8012:8012 nttlong/py310-xdoc:amd.cpu.9.30.7 python3 /app/cy_xdoc/server.py
